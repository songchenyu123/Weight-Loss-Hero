<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fat Loss Hero - Weight Loss Game</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
    
    <style>
        /* ==================== Êñ∞Â¢ûÔºöÂÖ≥Âç°Áõ∏ÂÖ≥Ê†∑Âºè ==================== */
        .level-info-panel {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            margin: 10px 0;
            text-align: center;
            font-weight: bold;
            display: none;
        }
        
        .level-complete-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.85);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        
        .level-complete-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 500px;
            animation: celebrate 1s ease-out;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }
        
        @keyframes celebrate {
            0% { transform: scale(0.5) rotate(-10deg); opacity: 0; }
            50% { transform: scale(1.1) rotate(5deg); }
            100% { transform: scale(1) rotate(0); opacity: 1; }
        }
        
        /* ==================== ÂéüÊúâÂÖ®Â±ÄÊ†∑Âºè ==================== */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body { 
            padding: 20px; 
            font-family: Arial, sans-serif; 
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }
        
        .register-container {
            max-width: 500px;
            margin: 50px auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
            display: block;
        }
        
        .main-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
            display: none;
        }
        
        .register-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .register-header h1 {
            font-size: 36px;
            margin-bottom: 10px;
        }
        
        .register-content {
            padding: 30px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus, .form-group select:focus {
            border-color: #667eea;
            outline: none;
        }
        
        .goal-selection {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 10px;
        }
        
        .goal-option {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .goal-option:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }
        
        .goal-option.selected {
            border-color: #667eea;
            background: #f0f4ff;
        }
        
        .goal-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }
        
        .register-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            transition: transform 0.2s;
        }
        
        .register-btn:hover {
            transform: translateY(-2px);
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
        }
        
        .main-content {
            padding: 25px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }
        
        .checkin-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }
        
        .checkin-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .checkin-title {
            font-size: 18px;
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .checkin-input-group {
            margin-bottom: 15px;
        }
        
        .checkin-input-group label {
            display: block;
            margin-bottom: 5px;
            color: #666;
            font-size: 14px;
        }
        
        .checkin-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .checkin-input:focus {
            border-color: #667eea;
            outline: none;
        }
        
        .checkin-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .checkin-btn:hover {
            transform: translateY(-2px);
        }
        
        .tickets-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .ticket-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .ticket-icon {
            font-size: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }
        
        .ticket-1 .ticket-icon { background: #ff6b6b; }
        .ticket-2 .ticket-icon { background: #4ecdc4; }
        .ticket-3 .ticket-icon { background: #ffd166; }
        
        .ticket-info h3 {
            color: #333;
            margin-bottom: 5px;
        }
        
        .ticket-count {
            font-size: 28px;
            font-weight: bold;
            color: #333;
        }
        
        .ticket-desc {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        
        .calendar-btn {
            width: 100%;
            padding: 15px;
            background: #f8f9fa;
            border: 2px dashed #ddd;
            border-radius: 10px;
            color: #666;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s;
        }
        
        .calendar-btn:hover {
            border-color: #667eea;
            color: #667eea;
        }
        
        .start-game-btn {
            grid-column: 1 / -1;
            padding: 18px;
            background: linear-gradient(135deg, #ff6b6b 0%, #ff8e8e 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .start-game-btn:hover {
            transform: translateY(-3px);
        }
        
        .controls-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            grid-column: 1 / -1;
        }
        
        .controls-card h3 {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .controls-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }
        
        .control-item {
            background: rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            transition: transform 0.2s;
        }
        
        .control-item:hover {
            transform: translateY(-3px);
            background: rgba(255,255,255,0.3);
        }
        
        .control-key {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
            background: rgba(255,255,255,0.2);
            padding: 5px 15px;
            border-radius: 5px;
            display: inline-block;
        }
        
        .control-desc {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .calendar-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .calendar-content {
            background: white;
            width: 90%;
            max-width: 500px;
            border-radius: 15px;
            overflow: hidden;
            animation: slideIn 0.3s;
        }
        
        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .calendar-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .calendar-grid {
            padding: 20px;
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
        }
        
        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        
        .calendar-day:hover {
            background: #f0f0f0;
        }
        
        .calendar-day.checked {
            background: linear-gradient(135deg, #a8edea, #fed6e3);
        }
        
        .calendar-day.today {
            border: 2px solid #667eea;
        }
        
        .flower {
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 12px;
        }
        
        .fat-loss {
            position: absolute;
            bottom: 2px;
            font-size: 9px;
            color: #27ae60;
        }
        
        #game-area { 
            display: none;
            position: relative;
            width: 800px; 
            height: 500px; 
            border: 3px solid #2c3e50;
            border-radius: 10px;
            margin: 20px auto; 
            background: linear-gradient(180deg, #1a2980, #26d0ce);
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        #player {
            position: absolute; 
            width: 60px; 
            height: 60px; 
            background: white; 
            border-radius: 50%;
            bottom: 20px; 
            left: 400px;
            z-index: 10;
            box-shadow: 0 0 10px rgba(255,255,255,0.7);
        }
        
        #enemies, #bullets {
            position: absolute; 
            width: 100%; 
            height: 100%; 
            top: 0; 
            left: 0;
        }
        
        .enemy {
            position: absolute;
            width: 50px;
            height: 50px;
            background: red;
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(255,0,0,0.7);
            transition: all 0.3s;
        }
        
        .bullet {
            position: absolute;
            width: 6px;
            height: 20px;
            background: yellow;
            border-radius: 3px;
            box-shadow: 0 0 10px yellow;
        }
        
        .slow-bullet {
            background: #3498db;
            box-shadow: 0 0 10px #3498db;
        }
        
        .burst-bullet {
            background: #9b59b6;
            box-shadow: 0 0 15px #9b59b6;
            width: 10px;
        }
        
        #game-info {
            position: absolute; 
            top: 15px; 
            left: 15px; 
            right: 15px;
            background: rgba(255,255,255,0.95); 
            padding: 12px 20px; 
            border-radius: 10px;
            z-index: 20;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .info-item {
            font-size: 16px;
            color: #2c3e50;
        }
        
        .highlight {
            color: #e74c3c;
            font-weight: bold;
        }
        
        .controls-info {
            position: absolute;
            bottom: 20px;
            left: 0;
            right: 0;
            text-align: center;
            color: white;
            font-size: 16px;
            background: rgba(0,0,0,0.6);
            padding: 10px;
            border-radius: 5px;
            margin: 0 20px;
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
        }
        
        .key-hint {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 5px 10px;
            background: rgba(255,255,255,0.2);
            border-radius: 5px;
        }
        
        .key {
            background: white;
            color: #2c3e50;
            padding: 2px 8px;
            border-radius: 4px;
            font-weight: bold;
            font-size: 14px;
        }
        
        #game-over {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .game-over-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            max-width: 400px;
            animation: popIn 0.3s;
        }
        
        @keyframes popIn {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        
        .stats-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .stat-item {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: #667eea;
            margin: 5px 0;
        }
        
        .stat-label {
            color: #666;
            font-size: 14px;
        }
        
        .user-info-panel {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .user-basic {
            font-size: 16px;
        }
        
        .user-goal {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .progress-container {
            background: rgba(255,255,255,0.2);
            height: 10px;
            border-radius: 5px;
            margin-top: 10px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: white;
            border-radius: 5px;
            transition: width 0.3s;
        }
        
        .error-message {
            color: #e74c3c;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }
        
        #edit-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
    </style>
</head>
<body>
    <!-- Êñ∞Â¢ûÔºöÂÖ≥Âç°‰ø°ÊÅØÈù¢Êùø -->
    <div class="level-info-panel" id="level-info-panel">
        Level <span id="current-level">1</span>/3 | Time Left: <span id="level-time-left">60</span>s
    </div>

    <!-- Ê≥®ÂÜåÈ°µÈù¢ -->
    <div class="register-container" id="register-container">
        <div class="register-header">
            <h1>üèÜ Fat Loss Hero</h1>
            <p>Start your weight loss journey today!</p>
        </div>
        
        <div class="register-content">
            <h2 style="margin-bottom: 25px; color: #333; text-align: center;">Set Your Weight Loss Goal</h2>
            
            <div class="form-group">
                <label for="current-weight">Current Weight (kg):</label>
                <input type="number" id="current-weight" placeholder="e.g. 70" min="30" max="200" value="70">
                <div class="error-message" id="weight-error"></div>
            </div>
            
            <div class="form-group">
                <label for="target-weight">Target Weight (kg):</label>
                <input type="number" id="target-weight" placeholder="e.g. 60" min="30" max="200" value="60">
                <div class="error-message" id="target-error"></div>
            </div>
            
            <div class="form-group">
                <label>Weight Loss Goal:</label>
                <div class="goal-selection">
                    <div class="goal-option" onclick="selectGoal('moderate')">
                        <div class="goal-icon">üê¢</div>
                        <div>Moderate</div>
                        <div style="font-size: 12px; color: #666;">0.5kg/week</div>
                    </div>
                    <div class="goal-option selected" onclick="selectGoal('healthy')">
                        <div class="goal-icon">üö∂</div>
                        <div>Healthy</div>
                        <div style="font-size: 12px; color: #666;">1kg/week</div>
                    </div>
                    <div class="goal-option" onclick="selectGoal('intense')">
                        <div class="goal-icon">üèÉ</div>
                        <div>Intense</div>
                        <div style="font-size: 12px; color: #666;">1.5kg/week</div>
                    </div>
                </div>
                <input type="hidden" id="goal-speed" value="healthy">
            </div>
            
            <div class="form-group">
                <label for="nickname">Nickname (Optional):</label>
                <input type="text" id="nickname" placeholder="e.g. Weight Loss Warrior">
            </div>
            
            <button class="register-btn" onclick="startJourney()">
                üöÄ Start My Journey
            </button>
            
            <p style="text-align: center; margin-top: 20px; color: #666; font-size: 14px;">
                Your data is saved to the cloud!
            </p>
        </div>
    </div>

    <!-- ‰∏ªÊ∏∏ÊàèÁïåÈù¢ -->
    <div class="main-container" id="main-container">
        <div class="user-info-panel" id="user-info-panel">
            <div>
                <div class="user-basic">‚öñÔ∏è Current: <span id="display-weight">70</span>kg | üéØ Target: <span id="display-target">60</span>kg</div>
                <div class="user-goal">üìÖ Goal: <span id="display-goal">1kg/week</span> | Days to goal: <span id="days-to-goal">70</span></div>
                <div class="progress-container">
                    <div class="progress-bar" id="progress-bar" style="width: 0%"></div>
                </div>
            </div>
            <div>
                <button onclick="showEditProfile()" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid white; padding: 5px 10px; border-radius: 5px; cursor: pointer;">
                    Edit
                </button>
                <button onclick="resetData()" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid white; padding: 5px 10px; border-radius: 5px; cursor: pointer; margin-left: 10px;">
                    Reset
                </button>
            </div>
        </div>
        
        <div class="header">
            <h1>üèÜ Fat Loss Hero</h1>
            <p>Shoot fat cells, get rewards, become a weight loss hero!</p>
        </div>
        
        <div class="main-content">
            <div class="checkin-section">
                <h2 style="margin-bottom: 20px; color: #333;">Daily Check-in</h2>
                
                <div class="checkin-card">
                    <div class="checkin-title">
                        üèÉ Exercise
                        <span style="font-size: 12px; color: #666;">(‚â•10 min)</span>
                    </div>
                    <div class="checkin-input-group">
                        <label>Minutes:</label>
                        <input type="number" id="sport-minutes" class="checkin-input" value="30" min="10">
                    </div>
                    <button class="checkin-btn" onclick="submitExercise()">
                        Get Revival Tickets
                    </button>
                    <p style="font-size: 12px; color: #666; margin-top: 10px;">
                        10 min = 1 Revival Ticket
                    </p>
                </div>
                
                <div class="checkin-card">
                    <div class="checkin-title">
                        üíß Water
                        <span style="font-size: 12px; color: #666;">(‚â•1 cup)</span>
                    </div>
                    <div class="checkin-input-group">
                        <label>Cups (250ml):</label>
                        <input type="number" id="water-cups" class="checkin-input" value="8" min="1">
                    </div>
                    <button class="checkin-btn" onclick="submitWater()">
                        Get Slow Tickets
                    </button>
                    <p style="font-size: 12px; color: #666; margin-top: 10px;">
                        1 cup = 1 Slow Ticket
                    </p>
                </div>
                
                <div class="checkin-card">
                    <div class="checkin-title">
                        üçé On-time Meals
                    </div>
                    <div class="checkin-input-group">
                        <label>Had meals on time?</label>
                        <select id="meal-status" class="checkin-input">
                            <option value="yes">‚úÖ Yes (Get 1 Burst Ticket)</option>
                            <option value="no">‚ùå No</option>
                        </select>
                    </div>
                    <button class="checkin-btn" onclick="submitMeal()">
                        Get Burst Tickets
                    </button>
                    <p style="font-size: 12px; color: #666; margin-top: 10px;">
                        Increases attack power
                    </p>
                </div>
                
                <button class="calendar-btn" onclick="openCalendar()">
                    üìÖ View Exercise Calendar
                </button>
            </div>
            
            <div class="tickets-section">
                <h2 style="margin-bottom: 20px; color: #333;">My Game Tickets</h2>
                
                <div class="ticket-card ticket-1">
                    <div class="ticket-icon">üèÉ</div>
                    <div class="ticket-info">
                        <h3>Revival Tickets</h3>
                        <div class="ticket-count" id="revival-count">0</div>
                        <div class="ticket-desc">Revive when game over</div>
                    </div>
                </div>
                
                <div class="ticket-card ticket-2">
                    <div class="ticket-icon">üíß</div>
                    <div class="ticket-info">
                        <h3>Slow Tickets</h3>
                        <div class="ticket-count" id="slow-count">0</div>
                        <div class="ticket-desc">Slow down enemies</div>
                    </div>
                </div>
                
                <div class="ticket-card ticket-3">
                    <div class="ticket-icon">üçé</div>
                    <div class="ticket-info">
                        <h3>Burst Tickets</h3>
                        <div class="ticket-count" id="burst-count">0</div>
                        <div class="ticket-desc">Shoot 3 bullets at once</div>
                    </div>
                </div>
                
                <div class="stats-card">
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value" id="total-fat">0</div>
                            <div class="stat-label">Total Fat Lost (kg)</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="total-days">0</div>
                            <div class="stat-label">Check-in Days</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="total-flowers">0</div>
                            <div class="stat-label">Flowers Earned</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="total-calories">0</div>
                            <div class="stat-label">Calories Burned</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="controls-card">
                <h3>üéÆ Game Controls</h3>
                <div class="controls-grid">
                    <div class="control-item">
                        <div class="control-key">‚Üê ‚Üí</div>
                        <div class="control-desc">Move Player</div>
                    </div>
                    <div class="control-item">
                        <div class="control-key">SPACE</div>
                        <div class="control-desc">Normal Shot</div>
                    </div>
                    <div class="control-item">
                        <div class="control-key">D</div>
                        <div class="control-desc">Slow Shot (Uses 1 Slow Ticket)</div>
                    </div>
                    <div class="control-item">
                        <div class="control-key">S</div>
                        <div class="control-desc">Burst Shot (Uses 1 Burst Ticket)</div>
                    </div>
                    <div class="control-item">
                        <div class="control-key">ESC</div>
                        <div class="control-desc">Pause Game</div>
                    </div>
                    <div class="control-item">
                        <div class="control-key">TAB</div>
                        <div class="control-desc">Show/Hide Controls</div>
                    </div>
                </div>
                <p style="margin-top: 15px; font-size: 14px; opacity: 0.9;">
                    üí° Tip: Collect tickets by checking in daily! Each ticket gives you special abilities in the game.
                </p>
            </div>
            
            <button class="start-game-btn" onclick="startGame()">
                üéÆ Start Fat Loss Hero Game
            </button>
        </div>
    </div>

    <!-- Ê∏∏ÊàèÂå∫Âüü -->
    <div id="game-area">
        <div id="player"></div>
        <div id="enemies"></div>
        <div id="bullets"></div>
        <div id="game-info">
            <div class="info-item">‚ù§Ô∏è Life: <span id="life" class="highlight">3</span></div>
            <div class="info-item">üèÉ Revival: <span id="game-revival" class="highlight">0</span></div>
            <div class="info-item">üíß Slow: <span id="game-slow" class="highlight">0</span></div>
            <div class="info-item">üçé Burst: <span id="game-burst" class="highlight">0</span></div>
            <div class="info-item">üéØ Score: <span id="score" class="highlight">0</span></div>
        </div>
        <div class="controls-info">
            <div class="key-hint"><span class="key">‚Üê</span><span class="key">‚Üí</span> Move</div>
            <div class="key-hint"><span class="key">SPACE</span> Normal Shot</div>
            <div class="key-hint"><span class="key">D</span> Slow Shot</div>
            <div class="key-hint"><span class="key">S</span> Burst Shot</div>
            <div class="key-hint"><span class="key">ESC</span> Pause</div>
        </div>
    </div>

    <!-- Êñ∞Â¢ûÔºöÂÖ≥Âç°ÈÄöÂÖ≥ÂºπÁ™ó -->
    <div id="level-complete-modal" class="level-complete-modal">
        <div class="level-complete-content">
            <h1 style="font-size: 48px; margin-bottom: 20px;">üéâ LEVEL COMPLETE!</h1>
            <h2 id="complete-level-title" style="margin-bottom: 30px;">Level 1 Completed!</h2>
            <div style="font-size: 20px; margin-bottom: 30px;">
                <p>üéØ Time Survived: <span id="level-time-survived">60</span> seconds</p>
                <p>üèÜ Enemies Defeated: <span id="level-enemies-defeated">0</span></p>
                <p>‚ú® Reward Earned: <span id="level-reward">0</span> points + <span id="level-ticket-reward">0</span> tickets</p>
            </div>
            <div style="display: flex; gap: 15px; justify-content: center;">
                <button onclick="nextLevel()" style="padding: 15px 30px; background: white; color: #667eea; border: none; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer;">
                    NEXT LEVEL ‚Üí
                </button>
                <button onclick="backToMainFromLevel()" style="padding: 15px 30px; background: rgba(255,255,255,0.2); color: white; border: 2px solid white; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer;">
                    BACK TO MAIN
                </button>
            </div>
            <p style="margin-top: 30px; font-size: 14px; opacity: 0.8;">
                Level Progress: <span id="levels-completed">0</span>/3 completed
            </p>
        </div>
    </div>

    <!-- Êó•ÂéÜÂºπÁ™ó -->
    <div id="calendar-modal" class="calendar-modal">
        <div class="calendar-content">
            <div class="calendar-header">
                <h2 style="margin: 0;" id="calendar-month">December 2023</h2>
                <button onclick="closeCalendar()" style="background: none; border: none; color: white; font-size: 20px; cursor: pointer;">
                    ‚úï
                </button>
            </div>
            <div class="calendar-grid" id="calendar-days">
                <!-- Calendar days will be generated here -->
            </div>
        </div>
    </div>

    <!-- Ê∏∏ÊàèÁªìÊùüÂºπÁ™ó -->
    <div id="game-over">
        <div class="game-over-content">
            <h2 style="color: #e74c3c; margin-bottom: 20px;">Game Over!</h2>
            <p style="margin-bottom: 15px;">You survived: <span id="game-time" class="highlight">0</span> seconds</p>
            <p style="margin-bottom: 15px;">Score: <span id="final-score" class="highlight">0</span></p>
            <p style="margin-bottom: 20px;">Enemies defeated: <span id="enemies-defeated" class="highlight">0</span></p>
            <div style="display: flex; gap: 10px;">
                <button onclick="useRevivalTicket()" style="padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer;">
                    Use Revival Ticket
                </button>
                <button onclick="backToMain()" style="padding: 10px 20px; background: #95a5a6; color: white; border: none; border-radius: 5px; cursor: pointer;">
                    Back to Main
                </button>
            </div>
        </div>
    </div>

    <!-- ÁºñËæë‰∏™‰∫∫‰ø°ÊÅØÂºπÁ™ó -->
    <div id="edit-modal" class="calendar-modal">
        <div class="calendar-content">
            <div class="calendar-header">
                <h2 style="margin: 0;">Edit Profile</h2>
                <button onclick="closeEditModal()" style="background: none; border: none; color: white; font-size: 20px; cursor: pointer;">
                    ‚úï
                </button>
            </div>
            <div style="padding: 20px;">
                <div class="form-group">
                    <label for="edit-weight">Current Weight (kg):</label>
                    <input type="number" id="edit-weight" class="checkin-input" min="30" max="200">
                </div>
                <div class="form-group">
                    <label for="edit-target">Target Weight (kg):</label>
                    <input type="number" id="edit-target" class="checkin-input" min="30" max="200">
                </div>
                <button onclick="updateProfile()" class="checkin-btn" style="margin-top: 20px;">
                    Update Profile
                </button>
            </div>
        </div>
    </div>

    <script>
        // ==================== Firebase ÂàùÂßãÂåñ ====================
        const firebaseConfig = {
            apiKey: "AIzaSyA2R3Jt6ktHDHGrTN7wB9mW6uZXGq9pDSk",
            authDomain: "the-fat-loss-hero.firebaseapp.com",
            databaseURL: "https://the-fat-loss-hero-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "the-fat-loss-hero",
            storageBucket: "the-fat-loss-hero.firebasestorage.app",
            messagingSenderId: "415034891242",
            appId: "1:415034891242:web:07d67a2513940bd0633093",
            measurementId: "G-GW1314HBW3"
        };

        // ÂàùÂßãÂåñ Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const auth = firebase.auth();
        
        // ÈªòËÆ§Áî®Êà∑IDÔºàÂåøÂêçÁî®Êà∑Ôºâ
        let currentUserId = 'anonymous';

        // Â∞ùËØïÂåøÂêçÁôªÂΩï
        auth.signInAnonymously()
            .then(() => {
                console.log('Signed in anonymously');
                currentUserId = auth.currentUser.uid;
                checkIfGoalSet(); // ÁôªÂΩïÂêéÊ£ÄÊü•Êï∞ÊçÆ
            })
            .catch(error => {
                console.error('Anonymous sign-in failed:', error);
                checkIfGoalSet(); // Âç≥‰ΩøÁôªÂΩïÂ§±Ë¥•‰πüÊ£ÄÊü•Êï∞ÊçÆ
            });

        // ==================== Êñ∞Â¢ûÔºöÂÖ≥Âç°ÈÖçÁΩÆ ====================
        const LEVEL_CONFIGS = [
            { // Level 1
                timeNeeded: 60,
                enemySpeed: 1.0,
                spawnInterval: 1500,
                enemyMoveRange: 0,
                enemyColor: '#ff6b6b',
                reward: 50,
                ticketReward: { revival: 2, slow: 0, burst: 0 }
            },
            { // Level 2
                timeNeeded: 60,
                enemySpeed: 1.5,
                spawnInterval: 1200,
                enemyMoveRange: 80,
                enemyColor: '#4ecdc4',
                reward: 100,
                ticketReward: { revival: 0, slow: 3, burst: 0 }
            },
            { // Level 3
                timeNeeded: 60,
                enemySpeed: 2.0,
                spawnInterval: 800,
                enemyMoveRange: 120,
                enemyColor: '#ffd166',
                reward: 200,
                ticketReward: { revival: 2, slow: 3, burst: 5 }
            }
        ];

        // ==================== Ê∏∏ÊàèÊï∞ÊçÆ ====================
        let gameData = {
            userInfo: {
                weight: 70,
                targetWeight: 60,
                goalSpeed: 'healthy',
                nickname: '',
                startDate: null,
                daysToGoal: 0,
                progress: 0
            },
            revivalTickets: 0,
            slowTickets: 0,
            burstTickets: 0,
            totalFatLoss: 0,
            totalDays: 0,
            totalFlowers: 0,
            totalCalories: 0,
            calendar: {},
            
            // Êñ∞Â¢ûÔºöÂÖ≥Âç°Êï∞ÊçÆ
            levels: {
                current: 1,
                completed: [false, false, false],
                levelTimes: [60, 60, 60]
            }
        };

        // Ê∏∏ÊàèÁä∂ÊÄÅÂèòÈáè
        let life = 3;
        let score = 0;
        let gameStartTime = 0;
        let levelStartTime = 0;
        let enemiesDefeated = 0;
        let isGameRunning = false;
        let enemySpeed = 1.0;
        let baseEnemySpeed = 2;
        let spawnInterval = 1500;
        let enemyMoveRange = 0;
        let currentEnemyColor = '#ff6b6b';

        // Ê∏∏ÊàèÂÖÉÁ¥†
        let player, enemies, bullets, gameArea;
        let playerX = 400;
        let enemyInterval, gameTimer, levelTimer;
        let activeBullets = [];
        let activeEnemies = [];

        // ==================== ÂàùÂßãÂåñ ====================
        window.onload = function() {
            player = document.getElementById('player');
            enemies = document.getElementById('enemies');
            bullets = document.getElementById('bullets');
            gameArea = document.getElementById('game-area');
            
            document.addEventListener('keydown', handleKeydown);
        };

        // ==================== Firebase Êï∞ÊçÆÂáΩÊï∞ ====================
        function checkIfGoalSet() {
            // ‰ªé Firebase ËØªÂèñÊï∞ÊçÆ
            database.ref('users/' + currentUserId).once('value')
                .then(snapshot => {
                    if (snapshot.exists()) {
                        gameData = snapshot.val();
                        console.log('Data loaded from Firebase');
                        showMainInterface();
                    } else {
                        // Ê≤°ÊúâÊï∞ÊçÆÔºåÊòæÁ§∫Ê≥®ÂÜåÈ°µÈù¢
                        console.log('No data found, showing registration');
                        document.getElementById('register-container').style.display = 'block';
                    }
                })
                .catch(error => {
                    console.error('Error reading from Firebase:', error);
                    // ÂõûÈÄÄÂà∞ localStorage
                    const savedData = localStorage.getItem('fatLossHeroData');
                    if (savedData) {
                        gameData = JSON.parse(savedData);
                        showMainInterface();
                    } else {
                        document.getElementById('register-container').style.display = 'block';
                    }
                });
        }

        function saveGameData() {
            // ‰øùÂ≠òÂà∞ Firebase
            database.ref('users/' + currentUserId).set(gameData)
                .then(() => {
                    console.log('Data saved to Firebase successfully');
                })
                .catch(error => {
                    console.error('Error saving to Firebase:', error);
                    // ÂõûÈÄÄÂà∞ localStorage
                    localStorage.setItem('fatLossHeroData', JSON.stringify(gameData));
                });
        }

        // ==================== ÁõÆÊ†áËÆæÁΩÆÊ£ÄÊü• ====================
        function selectGoal(speed) {
            document.querySelectorAll('.goal-option').forEach(option => {
                option.classList.remove('selected');
            });
            event.target.closest('.goal-option').classList.add('selected');
            document.getElementById('goal-speed').value = speed;
        }

        function startJourney() {
            const weight = parseFloat(document.getElementById('current-weight').value);
            const targetWeight = parseFloat(document.getElementById('target-weight').value);
            const goalSpeed = document.getElementById('goal-speed').value;
            const nickname = document.getElementById('nickname').value;
            
            let hasError = false;
            
            if (!weight || weight < 30 || weight > 200) {
                showError('weight-error', 'Please enter a valid weight (30-200 kg)');
                hasError = true;
            }
            
            if (!targetWeight || targetWeight < 30 || targetWeight > 200 || targetWeight >= weight) {
                showError('target-error', 'Target weight must be less than current weight');
                hasError = true;
            }
            
            if (hasError) return;
            
            gameData.userInfo = {
                weight: weight,
                targetWeight: targetWeight,
                goalSpeed: goalSpeed,
                nickname: nickname,
                startDate: new Date().toISOString(),
                daysToGoal: calculateDaysToGoal(weight, targetWeight, goalSpeed),
                progress: 0
            };
            
            saveGameData();
            showMainInterface();
        }

        function showError(elementId, message) {
            const errorElement = document.getElementById(elementId);
            errorElement.textContent = message;
            errorElement.style.display = 'block';
        }

        // ==================== ‰∏ªÁïåÈù¢ÊòæÁ§∫ ====================
        function showMainInterface() {
            document.getElementById('register-container').style.display = 'none';
            document.getElementById('main-container').style.display = 'block';
            document.getElementById('level-info-panel').style.display = 'none';
            updateUserInfoDisplay();
            updateDisplay();
        }

        function updateUserInfoDisplay() {
            const user = gameData.userInfo;
            
            document.getElementById('display-weight').textContent = user.weight.toFixed(1);
            document.getElementById('display-target').textContent = user.targetWeight;
            
            let goalSpeedText;
            switch(user.goalSpeed) {
                case 'moderate': goalSpeedText = '0.5kg/week'; break;
                case 'healthy': goalSpeedText = '1kg/week'; break;
                case 'intense': goalSpeedText = '1.5kg/week'; break;
                default: goalSpeedText = '1kg/week';
            }
            document.getElementById('display-goal').textContent = goalSpeedText;
            
            const currentWeight = user.weight - gameData.totalFatLoss;
            const weightLost = user.weight - currentWeight;
            const totalToLose = user.weight - user.targetWeight;
            const progress = (weightLost / totalToLose) * 100;
            
            user.progress = Math.min(100, Math.max(0, progress));
            user.daysToGoal = Math.max(0, calculateDaysToGoal(currentWeight, user.targetWeight, user.goalSpeed));
            
            document.getElementById('days-to-goal').textContent = user.daysToGoal;
            document.getElementById('progress-bar').style.width = user.progress + '%';
        }

        // ==================== Â∑•ÂÖ∑ÂáΩÊï∞ ====================
        function calculateDaysToGoal(currentWeight, targetWeight, goalSpeed) {
            const weightToLose = currentWeight - targetWeight;
            let kgPerWeek;
            
            switch(goalSpeed) {
                case 'moderate': kgPerWeek = 0.5; break;
                case 'healthy': kgPerWeek = 1; break;
                case 'intense': kgPerWeek = 1.5; break;
                default: kgPerWeek = 1;
            }
            
            const weeksNeeded = weightToLose / kgPerWeek;
            return Math.ceil(weeksNeeded * 7);
        }

        // ==================== ÊâìÂç°ÂäüËÉΩ ====================
        function submitExercise() {
            const minutes = parseInt(document.getElementById('sport-minutes').value);
            if (minutes >= 10) {
                const tickets = Math.floor(minutes / 10);
                const calories = minutes * 10;
                const fatLoss = calories / 7700;
                
                gameData.revivalTickets += tickets;
                gameData.totalCalories += calories;
                gameData.totalFatLoss += fatLoss;
                
                recordToCalendar('exercise', minutes, calories, fatLoss);
                
                alert(`‚úÖ Exercise check-in successful!\n\nüé´ Gained: ${tickets} Revival Tickets\nüî• Burned: ${calories} calories\n‚öñÔ∏è Fat loss: ${fatLoss.toFixed(3)}kg\nüå∏ Earned: 1 flower`);
                
                saveGameData();
                updateDisplay();
                updateUserInfoDisplay();
            } else {
                alert('‚ùå Minimum 10 minutes required!');
            }
        }

        function submitWater() {
            const cups = parseInt(document.getElementById('water-cups').value);
            if (cups >= 1) {
                const calories = cups * 5;
                const fatLoss = calories / 7700;
                
                gameData.slowTickets += cups;
                gameData.totalCalories += calories;
                gameData.totalFatLoss += fatLoss;
                
                recordToCalendar('water', cups, calories, fatLoss);
                
                alert(`‚úÖ Water check-in successful!\n\nüé´ Gained: ${cups} Slow Tickets\nüí¶ Metabolism: ${calories} calories\n‚öñÔ∏è Fat loss: ${fatLoss.toFixed(3)}kg\nüå∏ Earned: 1 flower`);
                
                saveGameData();
                updateDisplay();
                updateUserInfoDisplay();
            } else {
                alert('‚ùå Minimum 1 cup required!');
            }
        }

        function submitMeal() {
            const status = document.getElementById('meal-status').value;
            if (status === 'yes') {
                const calories = 50;
                const fatLoss = calories / 7700;
                
                gameData.burstTickets += 1;
                gameData.totalCalories += calories;
                gameData.totalFatLoss += fatLoss;
                
                recordToCalendar('meal', 1, calories, fatLoss);
                
                alert(`‚úÖ Meal check-in successful!\n\nüé´ Gained: 1 Burst Ticket\nüçé Metabolism: ${calories} calories\n‚öñÔ∏è Fat loss: ${fatLoss.toFixed(3)}kg\nüå∏ Earned: 1 flower`);
                
                saveGameData();
                updateDisplay();
                updateUserInfoDisplay();
            } else {
                alert('‚ùì No tickets for missed meals. Try to eat on time!');
            }
        }

        function recordToCalendar(type, amount, calories, fatLoss) {
            const today = new Date().toDateString();
            const todayData = gameData.calendar[today] || {
                exercise: 0,
                water: 0,
                meal: false,
                calories: 0,
                fatLoss: 0,
                flowers: 0
            };
            
            if (type === 'exercise') {
                todayData.exercise += amount;
            } else if (type === 'water') {
                todayData.water += amount;
            } else if (type === 'meal') {
                todayData.meal = true;
            }
            
            todayData.calories += calories;
            todayData.fatLoss += fatLoss;
            
            if (!gameData.calendar[today]) {
                todayData.flowers += 1;
                gameData.totalFlowers += 1;
                gameData.totalDays += 1;
            }
            
            gameData.calendar[today] = todayData;
        }

        // ==================== ÁºñËæë‰∏™‰∫∫‰ø°ÊÅØ ====================
        function showEditProfile() {
            document.getElementById('edit-weight').value = gameData.userInfo.weight;
            document.getElementById('edit-target').value = gameData.userInfo.targetWeight;
            document.getElementById('edit-modal').style.display = 'flex';
        }

        function closeEditModal() {
            document.getElementById('edit-modal').style.display = 'none';
        }

        function updateProfile() {
            const newWeight = parseFloat(document.getElementById('edit-weight').value);
            const newTarget = parseFloat(document.getElementById('edit-target').value);
            
            if (newWeight < 30 || newWeight > 200) {
                alert('Please enter a valid weight (30-200 kg)!');
                return;
            }
            
            if (newTarget < 30 || newTarget > 200 || newTarget >= newWeight) {
                alert('Target weight must be less than current weight!');
                return;
            }
            
            gameData.userInfo.weight = newWeight;
            gameData.userInfo.targetWeight = newTarget;
            gameData.userInfo.daysToGoal = calculateDaysToGoal(newWeight, newTarget, gameData.userInfo.goalSpeed);
            
            updateUserInfoDisplay();
            closeEditModal();
            saveGameData();
            alert('‚úÖ Profile updated successfully!');
        }

        function resetData() {
            if (confirm('Are you sure you want to reset all data? This will delete all your progress, tickets, and calendar records.')) {
                // ‰ªé Firebase Âà†Èô§Êï∞ÊçÆ
                database.ref('users/' + currentUserId).remove()
                    .then(() => {
                        console.log('Data removed from Firebase');
                        localStorage.removeItem('fatLossHeroData');
                        location.reload();
                    })
                    .catch(error => {
                        console.error('Error removing data:', error);
                        localStorage.removeItem('fatLossHeroData');
                        location.reload();
                    });
            }
        }

        // ==================== Êó•ÂéÜÂäüËÉΩ ====================
        function openCalendar() {
            generateCalendar();
            document.getElementById('calendar-modal').style.display = 'flex';
        }

        function closeCalendar() {
            document.getElementById('calendar-modal').style.display = 'none';
        }

        function generateCalendar() {
            const today = new Date();
            const currentYear = today.getFullYear();
            const currentMonth = today.getMonth();
            
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                               'July', 'August', 'September', 'October', 'November', 'December'];
            
            document.getElementById('calendar-month').textContent = 
                `${monthNames[currentMonth]} ${currentYear}`;
            
            const calendarGrid = document.getElementById('calendar-days');
            calendarGrid.innerHTML = '';
            
            const weekdays = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            weekdays.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.style.textAlign = 'center';
                dayHeader.style.fontWeight = 'bold';
                dayHeader.style.color = '#666';
                dayHeader.textContent = day;
                calendarGrid.appendChild(dayHeader);
            });
            
            const firstDay = new Date(currentYear, currentMonth, 1);
            const lastDay = new Date(currentYear, currentMonth + 1, 0);
            const daysInMonth = lastDay.getDate();
            
            const firstDayIndex = firstDay.getDay();
            for (let i = 0; i < firstDayIndex; i++) {
                calendarGrid.appendChild(document.createElement('div'));
            }
            
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = day;
                
                const dateKey = new Date(currentYear, currentMonth, day).toDateString();
                const dayData = gameData.calendar[dateKey];
                
                if (day === today.getDate() && 
                    currentMonth === today.getMonth() && 
                    currentYear === today.getFullYear()) {
                    dayElement.classList.add('today');
                }
                
                if (dayData) {
                    dayElement.classList.add('checked');
                    
                    if (dayData.flowers > 0) {
                        const flower = document.createElement('div');
                        flower.className = 'flower';
                        flower.textContent = 'üå∏';
                        dayElement.appendChild(flower);
                    }
                    
                    if (dayData.fatLoss > 0) {
                        const fatLoss = document.createElement('div');
                        fatLoss.className = 'fat-loss';
                        fatLoss.textContent = `-${dayData.fatLoss.toFixed(1)}kg`;
                        dayElement.appendChild(fatLoss);
                    }
                }
                
                dayElement.onclick = () => showDayDetails(dateKey, dayData);
                calendarGrid.appendChild(dayElement);
            }
        }

        function showDayDetails(dateKey, dayData) {
            const date = new Date(dateKey);
            const dateStr = date.toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            if (dayData) {
                alert(`üìÖ ${dateStr}\n\n` +
                      `üèÉ Exercise: ${dayData.exercise || 0} minutes\n` +
                      `üíß Water: ${dayData.water || 0} cups\n` +
                      `üçé Meals: ${dayData.meal ? 'On time ‚úÖ' : 'Missed ‚ùå'}\n` +
                      `üî• Calories: ${dayData.calories || 0}\n` +
                      `‚öñÔ∏è Fat loss: ${dayData.fatLoss.toFixed(2)}kg\n` +
                      `üå∏ Flowers: ${dayData.flowers || 0}`);
            } else {
                alert(`üìÖ ${dateStr}\n\nNo check-in records for this day.`);
            }
        }

        // ==================== ÊòæÁ§∫Êõ¥Êñ∞ ====================
        function updateDisplay() {
            document.getElementById('revival-count').textContent = gameData.revivalTickets;
            document.getElementById('slow-count').textContent = gameData.slowTickets;
            document.getElementById('burst-count').textContent = gameData.burstTickets;
            document.getElementById('total-fat').textContent = gameData.totalFatLoss.toFixed(2);
            document.getElementById('total-days').textContent = gameData.totalDays;
            document.getElementById('total-flowers').textContent = gameData.totalFlowers;
            document.getElementById('total-calories').textContent = gameData.totalCalories;
        }

        // ==================== Ê∏∏ÊàèÂäüËÉΩ ====================
        function startGame() {
            if (gameData.revivalTickets === 0 && 
                gameData.slowTickets === 0 && 
                gameData.burstTickets === 0) {
                alert('‚ùå No tickets! Please check-in first.');
                return;
            }
            
            document.getElementById('main-container').style.display = 'none';
            document.getElementById('game-area').style.display = 'block';
            
            initGame();
        }

        function initGame() {
            // ÈáçÁΩÆÂÖ≥Âç°‰∏∫Á¨¨1ÂÖ≥
            gameData.levels.current = 1;
            
            const levelConfig = LEVEL_CONFIGS[gameData.levels.current - 1];
            
            life = 3;
            score = 0;
            enemiesDefeated = 0;
            playerX = 400;
            enemySpeed = levelConfig.enemySpeed;
            spawnInterval = levelConfig.spawnInterval;
            enemyMoveRange = levelConfig.enemyMoveRange;
            currentEnemyColor = levelConfig.enemyColor;
            
            enemies.innerHTML = '';
            bullets.innerHTML = '';
            activeBullets = [];
            activeEnemies = [];
            
            updateGameDisplay();
            player.style.left = playerX + 'px';
            
            gameStartTime = Date.now();
            levelStartTime = Date.now();
            
            // ÊòæÁ§∫ÂÖ≥Âç°‰ø°ÊÅØÈù¢Êùø
            document.getElementById('level-info-panel').style.display = 'block';
            updateLevelInfo();
            
            gameTimer = setInterval(updateGameTime, 1000);
            levelTimer = setInterval(updateLevelTime, 100);
            startEnemySpawning();
            
            isGameRunning = true;
            
            showLevelStartMessage();
        }

        function showLevelStartMessage() {
            const levelConfig = LEVEL_CONFIGS[gameData.levels.current - 1];
            alert(`üéÆ Level ${gameData.levels.current} Started!\n\n` +
                  `üéØ Goal: Survive for ${levelConfig.timeNeeded} seconds\n` +
                  `‚ö° Enemy Speed: ${levelConfig.enemySpeed}x\n` +
                  `üé≠ Enemy Movement: ${levelConfig.enemyMoveRange > 0 ? 'Left/Right' : 'Straight down'}\n\n` +
                  `Use tickets wisely and survive!`);
        }

        function updateLevelInfo() {
            const levelConfig = LEVEL_CONFIGS[gameData.levels.current - 1];
            document.getElementById('current-level').textContent = gameData.levels.current;
            document.getElementById('level-time-left').textContent = levelConfig.timeNeeded;
        }

        function updateLevelTime() {
            if (!isGameRunning) return;
            
            const levelConfig = LEVEL_CONFIGS[gameData.levels.current - 1];
            const timeElapsed = Math.floor((Date.now() - levelStartTime) / 1000);
            const timeLeft = Math.max(0, levelConfig.timeNeeded - timeElapsed);
            
            document.getElementById('level-time-left').textContent = timeLeft;
            
            // Ê£ÄÊü•ÊòØÂê¶ÈÄöÂÖ≥
            if (timeElapsed >= levelConfig.timeNeeded) {
                completeLevel();
            }
        }

        function startEnemySpawning() {
            if (enemyInterval) clearInterval(enemyInterval);
            
            enemyInterval = setInterval(() => {
                spawnEnemy();
                if (spawnInterval > 300) {
                    spawnInterval -= 20;
                }
            }, spawnInterval);
        }

        function spawnEnemy() {
            const enemy = document.createElement('div');
            enemy.className = 'enemy';
            enemy.style.backgroundColor = currentEnemyColor;
            
            const startX = Math.random() * 750;
            enemy.style.left = startX + 'px';
            enemy.style.top = '-50px';
            enemies.appendChild(enemy);
            
            const enemyObj = {
                element: enemy,
                top: -50,
                x: startX,
                direction: Math.random() > 0.5 ? 1 : -1,
                moveRange: enemyMoveRange,
                interval: setInterval(() => moveEnemy(enemyObj), 30)
            };
            
            activeEnemies.push(enemyObj);
        }

        function moveEnemy(enemy) {
            if (!isGameRunning) return;
            
            // ‰∏ä‰∏ãÁßªÂä®
            enemy.top += baseEnemySpeed * enemySpeed;
            enemy.element.style.top = enemy.top + 'px';
            
            // Â∑¶Âè≥ÁßªÂä®
            if (enemy.moveRange > 0) {
                enemy.x += enemy.direction * 0.8;
                
                if (enemy.x < 0) {
                    enemy.x = 0;
                    enemy.direction = 1;
                } else if (enemy.x > 750) {
                    enemy.x = 750;
                    enemy.direction = -1;
                }
                
                enemy.element.style.left = enemy.x + 'px';
            }
            
            if (enemy.top > 500) {
                removeEnemy(enemy);
                life--;
                updateGameDisplay();
                
                if (life <= 0) {
                    gameOver();
                }
            }
        }

        function removeEnemy(enemy) {
            clearInterval(enemy.interval);
            if (enemy.element.parentNode) {
                enemy.element.remove();
            }
            const index = activeEnemies.indexOf(enemy);
            if (index > -1) {
                activeEnemies.splice(index, 1);
            }
        }

        function handleKeydown(e) {
            if (!isGameRunning) return;
            
            switch(e.key) {
                case 'ArrowLeft':
                    if (playerX > 20) {
                        playerX -= 25;
                        player.style.left = playerX + 'px';
                    }
                    break;
                case 'ArrowRight':
                    if (playerX < 750) {
                        playerX += 25;
                        player.style.left = playerX + 'px';
                    }
                    break;
                case ' ':
                    shootBullet('normal');
                    break;
                case 'd':
                case 'D':
                    if (gameData.slowTickets > 0) {
                        gameData.slowTickets--;
                        shootBullet('slow');
                        updateGameDisplay();
                    } else {
                        alert('No Slow Tickets left! Check in by drinking water to get more.');
                    }
                    break;
                case 's':
                case 'S':
                    if (gameData.burstTickets > 0) {
                        gameData.burstTickets--;
                        shootBullet('burst');
                        updateGameDisplay();
                    } else {
                        alert('No Burst Tickets left! Check in by eating on time to get more.');
                    }
                    break;
                case 'Escape':
                    togglePause();
                    break;
                case 'Tab':
                    e.preventDefault();
                    toggleControls();
                    break;
            }
        }

        function shootBullet(type) {
            let bulletCount = 1;
            let bulletClass = 'bullet';
            
            if (type === 'slow') {
                bulletClass = 'bullet slow-bullet';
            } else if (type === 'burst') {
                bulletCount = 3;
                bulletClass = 'bullet burst-bullet';
            }
            
            for (let i = 0; i < bulletCount; i++) {
                const bullet = document.createElement('div');
                bullet.className = bulletClass;
                
                let offset = 0;
                if (bulletCount > 1) {
                    offset = (i - 1) * 20;
                }
                
                bullet.style.left = (playerX + 27 + offset) + 'px';
                bullet.style.bottom = '90px';
                bullets.appendChild(bullet);
                
                const bulletObj = {
                    element: bullet,
                    bottom: 90,
                    interval: setInterval(() => moveBullet(bulletObj), 20)
                };
                
                activeBullets.push(bulletObj);
            }
        }

        function moveBullet(bullet) {
            if (!isGameRunning) return;
            
            bullet.bottom += 10;
            bullet.element.style.bottom = bullet.bottom + 'px';
            
            checkCollision(bullet);
            
            if (bullet.bottom > 500) {
                removeBullet(bullet);
            }
        }

        function checkCollision(bullet) {
            for (let i = 0; i < activeEnemies.length; i++) {
                const enemy = activeEnemies[i];
                const bulletRect = bullet.element.getBoundingClientRect();
                const enemyRect = enemy.element.getBoundingClientRect();
                
                if (bulletRect.left < enemyRect.right &&
                    bulletRect.right > enemyRect.left &&
                    bulletRect.top < enemyRect.bottom &&
                    bulletRect.bottom > enemyRect.top) {
                    
                    score += 10;
                    enemiesDefeated++;
                    
                    removeBullet(bullet);
                    removeEnemy(enemy);
                    updateGameDisplay();
                    
                    break;
                }
            }
        }

        function removeBullet(bullet) {
            clearInterval(bullet.interval);
            if (bullet.element.parentNode) {
                bullet.element.remove();
            }
            const index = activeBullets.indexOf(bullet);
            if (index > -1) {
                activeBullets.splice(index, 1);
            }
        }

        function updateGameDisplay() {
            document.getElementById('life').textContent = life;
            document.getElementById('game-revival').textContent = gameData.revivalTickets;
            document.getElementById('game-slow').textContent = gameData.slowTickets;
            document.getElementById('game-burst').textContent = gameData.burstTickets;
            document.getElementById('score').textContent = score;
        }

        function updateGameTime() {
            if (!isGameRunning) return;
            const timeElapsed = Math.floor((Date.now() - gameStartTime) / 1000);
        }

        function togglePause() {
            isGameRunning = !isGameRunning;
            if (!isGameRunning) {
                clearInterval(enemyInterval);
                clearInterval(levelTimer);
                activeBullets.forEach(b => clearInterval(b.interval));
                activeEnemies.forEach(e => clearInterval(e.interval));
                alert('Game Paused\nPress ESC to resume');
            } else {
                startEnemySpawning();
                activeBullets.forEach(b => {
                    b.interval = setInterval(() => moveBullet(b), 20);
                });
                activeEnemies.forEach(e => {
                    e.interval = setInterval(() => moveEnemy(e), 30);
                });
                levelTimer = setInterval(updateLevelTime, 100);
            }
        }

        function toggleControls() {
            const controls = document.querySelector('.controls-info');
            if (controls.style.display === 'none') {
                controls.style.display = 'flex';
            } else {
                controls.style.display = 'none';
            }
        }

        function completeLevel() {
            isGameRunning = false;
            clearInterval(enemyInterval);
            clearInterval(gameTimer);
            clearInterval(levelTimer);
            
            activeBullets.forEach(b => clearInterval(b.interval));
            activeEnemies.forEach(e => clearInterval(e.interval));
            
            const levelConfig = LEVEL_CONFIGS[gameData.levels.current - 1];
            
            gameData.levels.completed[gameData.levels.current - 1] = true;
            
            score += levelConfig.reward;
            gameData.revivalTickets += levelConfig.ticketReward.revival;
            gameData.slowTickets += levelConfig.ticketReward.slow;
            gameData.burstTickets += levelConfig.ticketReward.burst;
            
            saveGameData();
            
            showLevelComplete();
        }

        function showLevelComplete() {
            const levelConfig = LEVEL_CONFIGS[gameData.levels.current - 1];
            const timeSurvived = levelConfig.timeNeeded;
            const completedCount = gameData.levels.completed.filter(c => c).length;
            
            document.getElementById('complete-level-title').textContent = `Level ${gameData.levels.current} Completed!`;
            document.getElementById('level-time-survived').textContent = timeSurvived;
            document.getElementById('level-enemies-defeated').textContent = enemiesDefeated;
            document.getElementById('level-reward').textContent = levelConfig.reward;
            document.getElementById('level-ticket-reward').textContent = 
                `${levelConfig.ticketReward.revival} Revival, ${levelConfig.ticketReward.slow} Slow, ${levelConfig.ticketReward.burst} Burst`;
            document.getElementById('levels-completed').textContent = completedCount;
            
            document.getElementById('level-complete-modal').style.display = 'flex';
            
            createConfetti();
        }

        function createConfetti() {
            const colors = ['#ff6b6b', '#4ecdc4', '#ffd166', '#667eea', '#764ba2'];
            const container = document.getElementById('level-complete-modal');
            
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.top = '-10px';
                confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                
                container.appendChild(confetti);
                
                confetti.animate([
                    { transform: 'translateY(0) rotate(0deg)', opacity: 1 },
                    { transform: `translateY(${window.innerHeight}px) rotate(${Math.random() * 720}deg)`, opacity: 0 }
                ], {
                    duration: 2000 + Math.random() * 2000,
                    easing: 'cubic-bezier(0.215, 0.61, 0.355, 1)'
                });
                
                setTimeout(() => confetti.remove(), 4000);
            }
        }

        function nextLevel() {
            if (gameData.levels.current < 3) {
                gameData.levels.current++;
                
                document.getElementById('level-complete-modal').style.display = 'none';
                
                const levelConfig = LEVEL_CONFIGS[gameData.levels.current - 1];
                
                life = 3;
                enemiesDefeated = 0;
                playerX = 400;
                enemySpeed = levelConfig.enemySpeed;
                spawnInterval = levelConfig.spawnInterval;
                enemyMoveRange = levelConfig.enemyMoveRange;
                currentEnemyColor = levelConfig.enemyColor;
                
                enemies.innerHTML = '';
                bullets.innerHTML = '';
                activeBullets = [];
                activeEnemies = [];
                
                updateGameDisplay();
                player.style.left = playerX + 'px';
                
                levelStartTime = Date.now();
                
                updateLevelInfo();
                
                levelTimer = setInterval(updateLevelTime, 100);
                startEnemySpawning();
                
                isGameRunning = true;
                
                showLevelStartMessage();
            } else {
                document.getElementById('level-complete-modal').style.display = 'none';
                alert('üéâ CONGRATULATIONS!\n\nYou have completed all 3 levels!\n\nTotal Score: ' + score + '\n\nYou are a true Fat Loss Hero!');
                backToMain();
            }
        }

        function backToMainFromLevel() {
            document.getElementById('level-complete-modal').style.display = 'none';
            backToMain();
        }

        function gameOver() {
            isGameRunning = false;
            clearInterval(enemyInterval);
            clearInterval(gameTimer);
            clearInterval(levelTimer);
            activeBullets.forEach(b => clearInterval(b.interval));
            activeEnemies.forEach(e => clearInterval(e.interval));
            
            const timeSurvived = Math.floor((Date.now() - gameStartTime) / 1000);
            
            document.getElementById('game-time').textContent = timeSurvived;
            document.getElementById('final-score').textContent = score;
            document.getElementById('enemies-defeated').textContent = enemiesDefeated;
            document.getElementById('game-over').style.display = 'flex';
            
            saveGameData();
        }

        function useRevivalTicket() {
            if (gameData.revivalTickets > 0) {
                gameData.revivalTickets--;
                document.getElementById('game-over').style.display = 'none';
                
                life = 3;
                playerX = 400;
                
                enemies.innerHTML = '';
                bullets.innerHTML = '';
                activeBullets = [];
                activeEnemies = [];
                
                updateGameDisplay();
                player.style.left = playerX + 'px';
                
                levelStartTime = Date.now();
                startEnemySpawning();
                levelTimer = setInterval(updateLevelTime, 100);
                
                isGameRunning = true;
                
                alert('‚ú® Revived! Continue fighting!\nRemaining Revival Tickets: ' + gameData.revivalTickets);
            } else {
                alert('‚ùå No revival tickets left!\nDo exercise to earn more revival tickets.');
            }
        }

        function backToMain() {
            document.getElementById('game-over').style.display = 'none';
            document.getElementById('game-area').style.display = 'none';
            document.getElementById('level-complete-modal').style.display = 'none';
            document.getElementById('main-container').style.display = 'block';
            document.getElementById('level-info-panel').style.display = 'none';
            updateDisplay();
            updateUserInfoDisplay();
        }
    </script>
</body>
</html>